<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LightWeight Charts V2.1.0 - æ ¸å¿ƒç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            margin: 10px 0 0 0;
            font-size: 1.1em;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .test-section h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.3em;
        }
        
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .test-result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .chart-container {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 15px 0;
            background: white;
        }
        
        .controls {
            margin: 15px 0;
            text-align: center;
        }
        
        .controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .controls button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .status-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: bold;
            color: #495057;
        }
        
        .status-value {
            color: #6c757d;
            font-family: 'Courier New', monospace;
        }
        
        .log-panel {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .log-entry.success { color: #68d391; }
        .log-entry.error { color: #fc8181; }
        .log-entry.warn { color: #f6e05e; }
        .log-entry.info { color: #63b3ed; }
        
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-status {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ LightWeight Charts V2.1.0</h1>
            <p>æ ¸å¿ƒBaseChartå’Œé…ç½®ç³»ç»Ÿæµ‹è¯•</p>
        </div>
        
        <!-- ç³»ç»Ÿæ£€æŸ¥ -->
        <div class="test-section">
            <h3>ğŸ” ç³»ç»Ÿç»„ä»¶æ£€æŸ¥</h3>
            <div id="system-check"></div>
        </div>
        
        <!-- é…ç½®ç³»ç»Ÿæµ‹è¯• -->
        <div class="test-section">
            <h3>âš™ï¸ é…ç½®ç³»ç»Ÿæµ‹è¯•</h3>
            <div id="config-test"></div>
        </div>
        
        <!-- BaseChartæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“Š BaseChartåŠŸèƒ½æµ‹è¯•</h3>
            <div class="chart-container" id="test-chart"></div>
            <div class="controls">
                <button onclick="createTestChart()">åˆ›å»ºå›¾è¡¨</button>
                <button onclick="addTestSeries()">æ·»åŠ ç³»åˆ—</button>
                <button onclick="setTestData()">è®¾ç½®æ•°æ®</button>
                <button onclick="testTimeRange()">æµ‹è¯•æ—¶é—´èŒƒå›´</button>
                <button onclick="destroyTestChart()">é”€æ¯å›¾è¡¨</button>
            </div>
            <div class="status-panel" id="chart-status"></div>
        </div>
        
        <!-- äº‹ä»¶ç³»ç»Ÿæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“¡ äº‹ä»¶ç³»ç»Ÿæµ‹è¯•</h3>
            <div class="controls">
                <button onclick="testEventSystem()">æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ</button>
                <button onclick="clearEventLog()">æ¸…ç©ºæ—¥å¿—</button>
            </div>
            <div class="log-panel" id="event-log"></div>
        </div>
        
        <!-- æ³¨å†Œå™¨æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“‹ å›¾è¡¨æ³¨å†Œå™¨æµ‹è¯•</h3>
            <div class="controls">
                <button onclick="testRegistry()">æµ‹è¯•æ³¨å†Œå™¨</button>
                <button onclick="showRegistryStatus()">æ˜¾ç¤ºæ³¨å†ŒçŠ¶æ€</button>
            </div>
            <div class="status-panel" id="registry-status"></div>
        </div>
        
        <!-- MainChartåŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“ˆ MainChartåŠŸèƒ½æµ‹è¯•</h3>
            <div class="test-content">
                <div class="test-chart-container" id="mainChartContainer" style="width: 100%; height: 400px; border: 1px solid #ddd; margin: 10px 0;"></div>
                <div class="test-controls">
                    <button onclick="createMainChart()" class="test-btn">åˆ›å»ºä¸»å›¾</button>
                    <button onclick="loadMainChartData()" class="test-btn">åŠ è½½æ•°æ®</button>
                    <button onclick="clearMainChart()" class="test-btn">æ¸…ç©ºæ•°æ®</button>
                    <button onclick="destroyMainChart()" class="test-btn">é”€æ¯ä¸»å›¾</button>
                </div>
                <div class="test-status" id="mainChartStatus">çŠ¶æ€: æœªåˆ›å»º</div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥LightweightChartsåº“ -->
    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    
    <!-- å¼•å…¥é‡æ„ç‰ˆæœ¬ -->
    <script src="/static/lightweight-charts-v2.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let testChart = null;
        let testSeries = null;
        let eventLog = [];
        let testMainChart = null;
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œç³»ç»Ÿæ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            // ç­‰å¾…LightweightChartsåŠ è½½å®Œæˆ
            setTimeout(() => {
                performSystemCheck();
                testConfigSystem();
                setupEventLogging();
                checkLightweightChartsAPI();
            }, 100);
        });
        
        // ç³»ç»Ÿç»„ä»¶æ£€æŸ¥
        function performSystemCheck() {
            const checkDiv = document.getElementById('system-check');
            const checks = [
                { name: 'LightweightCharts', obj: window.LightweightCharts, desc: 'å›¾è¡¨åº“' },
                { name: 'ChartConfigV2', obj: window.ChartConfigV2, desc: 'é…ç½®ç®¡ç†' },
                { name: 'ChartUtilsV2', obj: window.ChartUtilsV2, desc: 'å·¥å…·å‡½æ•°' },
                { name: 'EventEmitter', obj: window.EventEmitter, desc: 'äº‹ä»¶ç³»ç»Ÿ' },
                { name: 'ChartRegistry', obj: window.ChartRegistry, desc: 'å›¾è¡¨æ³¨å†Œå™¨' },
                { name: 'BaseChart', obj: window.BaseChart, desc: 'åŸºç¡€å›¾è¡¨ç±»' },
                { name: 'MainChart', obj: window.MainChart, desc: 'ä¸»å›¾è¡¨ç±»' }
            ];
            
            let html = '';
            checks.forEach(check => {
                const exists = !!check.obj;
                const status = exists ? 'success' : 'error';
                const icon = exists ? 'âœ…' : 'âŒ';
                html += `<div class="test-result ${status}">${icon} ${check.name} (${check.desc}): ${exists ? 'å·²åŠ è½½' : 'æœªæ‰¾åˆ°'}</div>`;
            });
            
            checkDiv.innerHTML = html;
        }
        
        // é…ç½®ç³»ç»Ÿæµ‹è¯•
        function testConfigSystem() {
            const testDiv = document.getElementById('config-test');
            let html = '';
            
            try {
                // æµ‹è¯•é…ç½®éªŒè¯
                const isValid = ChartConfigV2.validate();
                html += `<div class="test-result ${isValid ? 'success' : 'error'}">é…ç½®éªŒè¯: ${isValid ? 'é€šè¿‡' : 'å¤±è´¥'}</div>`;
                
                // æµ‹è¯•è·å–ä¸åŒç±»å‹çš„é…ç½®
                const mainConfig = ChartConfigV2.getChartConfig('main');
                const volumeConfig = ChartConfigV2.getChartConfig('volume');
                const indicatorConfig = ChartConfigV2.getChartConfig('indicator');
                
                html += `<div class="test-result success">ä¸»å›¾é…ç½®: é«˜åº¦=${mainConfig.height}px</div>`;
                html += `<div class="test-result success">æˆäº¤é‡é…ç½®: é«˜åº¦=${volumeConfig.height}px</div>`;
                html += `<div class="test-result success">æŒ‡æ ‡é…ç½®: é«˜åº¦=${indicatorConfig.height}px</div>`;
                
                // æµ‹è¯•é¢œè‰²é…ç½®
                const colors = ChartConfigV2.COLORS;
                html += `<div class="test-result info">é¢œè‰²é…ç½®: ä¸Šæ¶¨=${colors.UP}, ä¸‹è·Œ=${colors.DOWN}</div>`;
                
                // æµ‹è¯•åŒæ­¥é…ç½®
                const sync = ChartConfigV2.SYNC;
                html += `<div class="test-result info">åŒæ­¥é…ç½®: èŠ‚æµå»¶è¿Ÿ=${sync.THROTTLE_DELAY}ms</div>`;
                
            } catch (error) {
                html += `<div class="test-result error">é…ç½®æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
            
            testDiv.innerHTML = html;
        }
        
        // åˆ›å»ºæµ‹è¯•å›¾è¡¨
        function createTestChart() {
            try {
                // æ£€æŸ¥LightweightChartsæ˜¯å¦å¯ç”¨
                if (!window.LightweightCharts) {
                    addLog('error', 'LightweightChartsåº“æœªåŠ è½½');
                    return;
                }
                
                const container = document.getElementById('test-chart');
                
                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';
                
                // åˆ›å»ºBaseChartå®ä¾‹
                testChart = new BaseChart(container, {
                    chartType: 'main',
                    width: container.clientWidth,
                    height: 400
                });
                
                // ç›‘å¬äº‹ä»¶
                testChart.on('created', () => {
                    addLog('success', 'å›¾è¡¨åˆ›å»ºæˆåŠŸ');
                    updateChartStatus();
                });
                
                testChart.on('error', (error) => {
                    addLog('error', `å›¾è¡¨é”™è¯¯: ${error.message}`);
                    updateChartStatus();
                });
                
                testChart.on('dataLoaded', (data) => {
                    addLog('info', `æ•°æ®å·²åŠ è½½: ${data.length} æ¡è®°å½•`);
                    updateChartStatus();
                });
                
                // åˆ›å»ºå›¾è¡¨
                testChart.create();
                
            } catch (error) {
                addLog('error', `åˆ›å»ºå›¾è¡¨å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ·»åŠ æµ‹è¯•ç³»åˆ—
        function addTestSeries() {
            if (!testChart) {
                addLog('warn', 'è¯·å…ˆåˆ›å»ºå›¾è¡¨');
                return;
            }
            
            try {
                testSeries = testChart.addSeries('candlestick', {
                    upColor: ChartConfigV2.COLORS.UP,
                    downColor: ChartConfigV2.COLORS.DOWN,
                    borderUpColor: ChartConfigV2.COLORS.UP,
                    borderDownColor: ChartConfigV2.COLORS.DOWN,
                    wickUpColor: ChartConfigV2.COLORS.UP,
                    wickDownColor: ChartConfigV2.COLORS.DOWN
                });
                
                if (testSeries) {
                    addLog('success', 'èœ¡çƒ›å›¾ç³»åˆ—æ·»åŠ æˆåŠŸ');
                    updateChartStatus();
                } else {
                    addLog('error', 'æ·»åŠ ç³»åˆ—å¤±è´¥');
                }
            } catch (error) {
                addLog('error', `æ·»åŠ ç³»åˆ—å¤±è´¥: ${error.message}`);
            }
        }
        
        // è®¾ç½®æµ‹è¯•æ•°æ®
        function setTestData() {
            if (!testSeries) {
                addLog('warn', 'è¯·å…ˆæ·»åŠ ç³»åˆ—');
                return;
            }
            
            try {
                // ç”Ÿæˆæµ‹è¯•æ•°æ®
                const testData = generateTestData();
                testSeries.setData(testData);
                
                addLog('success', `æµ‹è¯•æ•°æ®è®¾ç½®æˆåŠŸ: ${testData.length} æ¡è®°å½•`);
                updateChartStatus();
                
                // é€‚é…å†…å®¹
                setTimeout(() => {
                    testChart.fitContentToData();
                }, 100);
                
            } catch (error) {
                addLog('error', `è®¾ç½®æ•°æ®å¤±è´¥: ${error.message}`);
            }
        }
        
        // æµ‹è¯•æ—¶é—´èŒƒå›´
        function testTimeRange() {
            if (!testChart) {
                addLog('warn', 'è¯·å…ˆåˆ›å»ºå›¾è¡¨å¹¶è®¾ç½®æ•°æ®');
                return;
            }
            
            try {
                // è·å–å½“å‰æ—¶é—´èŒƒå›´
                const currentRange = testChart.getTimeRange();
                if (currentRange) {
                    addLog('info', `å½“å‰æ—¶é—´èŒƒå›´: ${new Date(currentRange.from * 1000).toLocaleString()} - ${new Date(currentRange.to * 1000).toLocaleString()}`);
                    
                    // è®¾ç½®æ–°çš„æ—¶é—´èŒƒå›´ï¼ˆç¼©æ”¾åˆ°ä¸­é—´éƒ¨åˆ†ï¼‰
                    const duration = currentRange.to - currentRange.from;
                    const newRange = {
                        from: currentRange.from + duration * 0.25,
                        to: currentRange.to - duration * 0.25
                    };
                    
                    testChart.setTimeRange(newRange);
                    addLog('success', 'æ—¶é—´èŒƒå›´è®¾ç½®æˆåŠŸ');
                } else {
                    addLog('warn', 'æ— æ³•è·å–æ—¶é—´èŒƒå›´');
                }
            } catch (error) {
                addLog('error', `æ—¶é—´èŒƒå›´æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // é”€æ¯æµ‹è¯•å›¾è¡¨
        function destroyTestChart() {
            if (testChart) {
                testChart.destroy();
                testChart = null;
                testSeries = null;
                addLog('success', 'å›¾è¡¨å·²é”€æ¯');
                updateChartStatus();
            } else {
                addLog('warn', 'æ²¡æœ‰å›¾è¡¨éœ€è¦é”€æ¯');
            }
        }
        
        // æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ
        function testEventSystem() {
            try {
                const emitter = new EventEmitter();
                
                // æµ‹è¯•åŸºæœ¬äº‹ä»¶
                emitter.on('test', (data) => {
                    addLog('success', `äº‹ä»¶æ¥æ”¶: ${data}`);
                });
                
                emitter.emit('test', 'Hello World!');
                
                // æµ‹è¯•ä¸€æ¬¡æ€§äº‹ä»¶
                emitter.once('once-test', (data) => {
                    addLog('info', `ä¸€æ¬¡æ€§äº‹ä»¶: ${data}`);
                });
                
                emitter.emit('once-test', 'First');
                emitter.emit('once-test', 'Second'); // è¿™ä¸ªä¸ä¼šè§¦å‘
                
                // æµ‹è¯•é“¾å¼è°ƒç”¨
                emitter.on('chain1', () => addLog('success', 'é“¾å¼äº‹ä»¶1'))
                       .on('chain2', () => addLog('success', 'é“¾å¼äº‹ä»¶2'));
                
                emitter.emit('chain1');
                emitter.emit('chain2');
                
                addLog('success', 'äº‹ä»¶ç³»ç»Ÿæµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                addLog('error', `äº‹ä»¶ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // æµ‹è¯•æ³¨å†Œå™¨
        function testRegistry() {
            try {
                // åˆ›å»ºæµ‹è¯•å›¾è¡¨
                const testContainer = document.createElement('div');
                const chart1 = new BaseChart(testContainer, { chartType: 'main' });
                const chart2 = new BaseChart(testContainer, { chartType: 'volume' });
                
                // æ³¨å†Œä¸»å›¾è¡¨
                ChartRegistry.register(chart1.id, chart1, true);
                
                addLog('success', `å›¾è¡¨æ³¨å†Œæµ‹è¯•å®Œæˆï¼Œæ€»æ•°: ${ChartRegistry.getChartCount()}`);
                addLog('info', `ä¸»å›¾è¡¨ID: ${ChartRegistry.getMainChart()?.id}`);
                
                // æ¸…ç†
                chart1.destroy();
                chart2.destroy();
                
            } catch (error) {
                addLog('error', `æ³¨å†Œå™¨æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ˜¾ç¤ºæ³¨å†Œå™¨çŠ¶æ€
        function showRegistryStatus() {
            const statusDiv = document.getElementById('registry-status');
            const charts = ChartRegistry.getAllCharts();
            const mainChart = ChartRegistry.getMainChart();
            
            let html = `
                <div class="status-item">
                    <span class="status-label">å›¾è¡¨æ€»æ•°:</span>
                    <span class="status-value">${ChartRegistry.getChartCount()}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ä¸»å›¾è¡¨:</span>
                    <span class="status-value">${mainChart ? mainChart.id : 'æ— '}</span>
                </div>
            `;
            
            charts.forEach((chart, index) => {
                const info = chart.getInfo();
                html += `
                    <div class="status-item">
                        <span class="status-label">å›¾è¡¨${index + 1}:</span>
                        <span class="status-value">${info.id} (${info.type})</span>
                    </div>
                `;
            });
            
            statusDiv.innerHTML = html;
        }
        
        // æ›´æ–°å›¾è¡¨çŠ¶æ€
        function updateChartStatus() {
            const statusDiv = document.getElementById('chart-status');
            
            if (!testChart) {
                statusDiv.innerHTML = '<div class="status-item"><span class="status-label">çŠ¶æ€:</span><span class="status-value">æ— å›¾è¡¨</span></div>';
                return;
            }
            
            const info = testChart.getInfo();
            const state = testChart.getState();
            
            let html = `
                <div class="status-item">
                    <span class="status-label">å›¾è¡¨ID:</span>
                    <span class="status-value">${info.id}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç±»å‹:</span>
                    <span class="status-value">${info.type}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç³»åˆ—æ•°é‡:</span>
                    <span class="status-value">${info.seriesCount}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æ•°æ®å·²åŠ è½½:</span>
                    <span class="status-value">${state.isDataLoaded ? 'æ˜¯' : 'å¦'}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å·²å¯¹é½:</span>
                    <span class="status-value">${state.isAligned ? 'æ˜¯' : 'å¦'}</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æœ‰é”™è¯¯:</span>
                    <span class="status-value">${state.hasError ? 'æ˜¯' : 'å¦'}</span>
                </div>
            `;
            
            if (state.hasError && state.errorMessage) {
                html += `
                    <div class="status-item">
                        <span class="status-label">é”™è¯¯ä¿¡æ¯:</span>
                        <span class="status-value">${state.errorMessage}</span>
                    </div>
                `;
            }
            
            statusDiv.innerHTML = html;
        }
        
        // è®¾ç½®äº‹ä»¶æ—¥å¿—
        function setupEventLogging() {
            // é‡å†™consoleæ–¹æ³•ä»¥æ•è·æ—¥å¿—
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;
            
            console.log = function(...args) {
                originalLog.apply(console, args);
                if (args[0] && typeof args[0] === 'string' && args[0].includes('ğŸ“Š')) {
                    addLog('info', args.join(' '));
                }
            };
            
            console.error = function(...args) {
                originalError.apply(console, args);
                if (args[0] && typeof args[0] === 'string' && args[0].includes('âŒ')) {
                    addLog('error', args.join(' '));
                }
            };
            
            console.warn = function(...args) {
                originalWarn.apply(console, args);
                if (args[0] && typeof args[0] === 'string') {
                    addLog('warn', args.join(' '));
                }
            };
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push({ type, message, timestamp });
            
            // é™åˆ¶æ—¥å¿—æ•°é‡
            if (eventLog.length > 50) {
                eventLog.shift();
            }
            
            updateEventLog();
        }
        
        // æ›´æ–°äº‹ä»¶æ—¥å¿—æ˜¾ç¤º
        function updateEventLog() {
            const logDiv = document.getElementById('event-log');
            let html = '';
            
            eventLog.forEach(log => {
                html += `<div class="log-entry ${log.type}">[${log.timestamp}] ${log.message}</div>`;
            });
            
            logDiv.innerHTML = html;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // æ¸…ç©ºäº‹ä»¶æ—¥å¿—
        function clearEventLog() {
            eventLog = [];
            updateEventLog();
        }
        
        // ç”Ÿæˆæµ‹è¯•æ•°æ®
        function generateTestData() {
            const data = [];
            const startTime = Math.floor(Date.now() / 1000) - 86400 * 30; // 30å¤©å‰
            let price = 100;
            
            for (let i = 0; i < 100; i++) {
                const time = startTime + i * 86400; // æ¯å¤©ä¸€ä¸ªæ•°æ®ç‚¹
                const change = (Math.random() - 0.5) * 4; // -2 åˆ° +2 çš„éšæœºå˜åŒ–
                price += change;
                
                const open = price;
                const close = price + (Math.random() - 0.5) * 2;
                const high = Math.max(open, close) + Math.random() * 1;
                const low = Math.min(open, close) - Math.random() * 1;
                
                data.push({
                    time: time,
                    open: parseFloat(open.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    close: parseFloat(close.toFixed(2))
                });
                
                price = close;
            }
            
            return data;
        }
        
        // MainChartæµ‹è¯•å‡½æ•°
        function createMainChart() {
            try {
                const container = document.getElementById('mainChartContainer');
                if (!container) {
                    updateStatus('mainChartStatus', 'âŒ å®¹å™¨ä¸å­˜åœ¨');
                    return;
                }

                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';

                // åˆ›å»ºä¸»å›¾
                testMainChart = new MainChart(container);
                testMainChart.create();

                updateStatus('mainChartStatus', 'âœ… ä¸»å›¾åˆ›å»ºæˆåŠŸ');
                addLog('MainChart åˆ›å»ºæˆåŠŸ', 'success');

            } catch (error) {
                updateStatus('mainChartStatus', `âŒ åˆ›å»ºå¤±è´¥: ${error.message}`);
                addLog(`MainChart åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function loadMainChartData() {
            if (!testMainChart) {
                updateStatus('mainChartStatus', 'âŒ è¯·å…ˆåˆ›å»ºä¸»å›¾');
                return;
            }

            try {
                // æµ‹è¯•æ•°æ®åŠ è½½
                const codes = ['HK.02432']; // æµ‹è¯•è‚¡ç¥¨ä»£ç ï¼ˆä½¿ç”¨å®é™…å­˜åœ¨çš„æ•°æ®ï¼‰
                const indicators = ['ma5', 'ma10', 'supertrend']; // æµ‹è¯•æŒ‡æ ‡

                testMainChart.loadData(codes, indicators)
                    .then(() => {
                        updateStatus('mainChartStatus', 'âœ… æ•°æ®åŠ è½½æˆåŠŸ');
                        addLog('MainChart æ•°æ®åŠ è½½æˆåŠŸ', 'success');
                    })
                    .catch(error => {
                        updateStatus('mainChartStatus', `âŒ æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`);
                        addLog(`MainChart æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                    });

                updateStatus('mainChartStatus', 'â³ æ­£åœ¨åŠ è½½æ•°æ®...');

            } catch (error) {
                updateStatus('mainChartStatus', `âŒ åŠ è½½å¤±è´¥: ${error.message}`);
                addLog(`MainChart æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function clearMainChart() {
            if (!testMainChart) {
                updateStatus('mainChartStatus', 'âŒ è¯·å…ˆåˆ›å»ºä¸»å›¾');
                return;
            }

            try {
                testMainChart.clearData();
                updateStatus('mainChartStatus', 'âœ… æ•°æ®å·²æ¸…ç©º');
                addLog('MainChart æ•°æ®å·²æ¸…ç©º', 'success');

            } catch (error) {
                updateStatus('mainChartStatus', `âŒ æ¸…ç©ºå¤±è´¥: ${error.message}`);
                addLog(`MainChart æ¸…ç©ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function destroyMainChart() {
            if (!testMainChart) {
                updateStatus('mainChartStatus', 'âŒ ä¸»å›¾ä¸å­˜åœ¨');
                return;
            }

            try {
                testMainChart.destroy();
                testMainChart = null;
                
                // æ¸…ç©ºå®¹å™¨
                const container = document.getElementById('mainChartContainer');
                if (container) {
                    container.innerHTML = '';
                }

                updateStatus('mainChartStatus', 'âœ… ä¸»å›¾å·²é”€æ¯');
                addLog('MainChart å·²é”€æ¯', 'success');

            } catch (error) {
                updateStatus('mainChartStatus', `âŒ é”€æ¯å¤±è´¥: ${error.message}`);
                addLog(`MainChart é”€æ¯å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤ºçš„è¾…åŠ©å‡½æ•°
        function updateStatus(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
            }
        }
        
        // æ£€æŸ¥LightweightCharts API
        function checkLightweightChartsAPI() {
            if (window.LightweightCharts) {
                addLog('success', `LightweightChartsç‰ˆæœ¬: ${window.LightweightCharts.version || 'æœªçŸ¥'}`);
                addLog('info', `createChartæ–¹æ³•: ${typeof window.LightweightCharts.createChart}`);
                
                // æµ‹è¯•åˆ›å»ºä¸€ä¸ªä¸´æ—¶å›¾è¡¨æ¥æ£€æŸ¥API
                try {
                    const tempContainer = document.createElement('div');
                    tempContainer.style.width = '100px';
                    tempContainer.style.height = '100px';
                    document.body.appendChild(tempContainer);
                    
                    const tempChart = window.LightweightCharts.createChart(tempContainer, {
                        width: 100,
                        height: 100
                    });
                    
                    addLog('info', `å›¾è¡¨æ–¹æ³•æ£€æŸ¥: addCandlestickSeries=${typeof tempChart.addCandlestickSeries}, addLineSeries=${typeof tempChart.addLineSeries}`);
                    
                    // æ¸…ç†
                    tempChart.remove();
                    document.body.removeChild(tempContainer);
                    
                } catch (error) {
                    addLog('error', `LightweightCharts APIæµ‹è¯•å¤±è´¥: ${error.message}`);
                }
            } else {
                addLog('error', 'LightweightChartsæœªåŠ è½½');
            }
        }
    </script>
</body>
</html> 